<script type="text/x-iobroker" data-template-name="linkeddevices">
	<div class="row">
		<div class="col s2 c_ParentObj_Enabled">
			<input type="checkbox" data-field="enabled" data-default="false"/>
			<!-- this field is mandatory, just to find out if to include this settings or not</span-->
			<span class="translate">enabled</span>
		</div>
		
		<div class="col s2 c_LinkedObj_isLinked">
			<input type="checkbox" id="isLinked" disabled="true"/>
			<span class="translate">is linked</span>
		</div>

		<div class="col s4">
			<div class="section s_ParentObj_LinkedId">
				<input type="text" data-field="linkedId" size="30">
				<span class="translate">id of linked object</span>
			</div>
			<div class="section s_ParentObj_Name">
				<input type="text" data-field="name" size="30">
				<span class="translate">name of linked object</span>
			</div>

			<div class="section s_LinkedObj_parentId">
					<input type="text" id="parentId" size="30" readonly>
					<span class="translate">linked with</span>
			</div>

			<div class="section s_test">
				<input type="text" id="test" size="30" readonly>
				<span class="translate">test</span>
		</div>
		</div>
		
		<div class="col s4 c_ParentObj_ExpertSettings">
			<input type="checkbox" id="expertSettings"/>
			<span class="translate">expert settings</span>

			<div class="section s_ParentObj_hasUnit">
				<input type="text" data-field="unit" size="30" disabled="true">
				<span class="translate">change unit</span>
			</div>

			<div class="section s_ParentObj_conversion">
				<div class="row">
					<div class="col s2">
						<select id="conversionType" disabled="true">
							<option value="xml">+ | -</option>
							<option value="bin">* | /</option>
						</select>
						<span class="translate">conversion</span>
					</div>
					<div class="col s10">
						<input type="text" data-field="conversion" size="30" disabled="true">
						<span class="translate">conversion</span>
					</div>
				</div>
			</div>
		</div>

		<!-- <div class="input-field col s4 group-factor">
			<input data-field="groupFactor" type="number" data-default="1" step=0.001 min=0.001 max=100/>
			<label class="translate" for="groupFactor" >Counter factor</label>
			<p class="translate">Conversion factor for consumption counter</p>

		</div> -->
	</div>
</script>

<script type="text/javascript">
	$.get("adapter/linkeddevices/words.js", function (script) {
		let translation = script.substring(script.indexOf('{'), script.length);
		translation = translation.substring(0, translation.lastIndexOf(';'));
		$.extend(systemDictionary, JSON.parse(translation));
	});

	// There are two ways how to predefine default settings:
	// - with attribute "data-default" (content independent)
	// - with function in global variable "defaults". Function name is equal with adapter name.
	//   as input function receives object with all information concerning it

	if (typeof defaults !== 'undefined') {

		defaults.linkeddevices = function (obj, instanceObj) {
			return {
				enabled: false,
				unit: obj.common.unit
			};
		}
	}

	if (typeof customPostInits !== 'undefined') {
		customPostInits.linkeddevices = function ($div, values, instanceObj, type, role) {

			// $div.find('input[data-field="test"]').val(values["isLinked"])
			// $div.find('input[data-field="enabled"]').hide();

			if (values["isLinked"] != undefined) {
				//linkedObject
				$div.find('.c_ParentObj_Enabled').hide();
				$div.find('.s_ParentObj_LinkedId').hide();
				$div.find('.s_ParentObj_Name').hide();

				$div.find('.c_LinkedObj_isLinked').show();
				$div.find('input[id="isLinked"]').prop('checked', values["isLinked"]);

				$div.find('.s_LinkedObj_parentId').show();
				$div.find('input[id="parentId"]').val(values["parentId"]);

				$div.find('.c_ParentObj_ExpertSettings').hide();

			} else {
				//parentObject
				$div.find('.c_ParentObj_Enabled').show();
				$div.find('.colParentObj_Input').show();
				$div.find('.c_ParentObj_ExpertSettings').show();

				$div.find('.c_LinkedObj_isLinked').hide();
				$div.find('.s_LinkedObj_parentId').hide();

				if (type === 'number') {
					$div.find('.s_ParentObj_hasUnit').show();
					$div.find('.s_ParentObj_conversion').show();
				} else {
					$div.find('.s_ParentObj_hasUnit').hide();
					$div.find('.s_ParentObj_conversion').hide();
				}
			}

			$div.find('input[id="test"]').val($div.find(type));

			$div.find('input[id="expertSettings"]').on('change', function () {
				// var checked = $(this).prop('checked');

				$div.find('input[data-field="unit"]').prop("disabled", !this.checked);
				$div.find('input[data-field="conversion"]').prop("disabled", !this.checked);
				$div.find('select[id=conversionType]').prop("disabled", !this.checked);

				gMain.showMessage("Halllo");
				
				// if (checked) {
				// 	//$div.find('input[data-field="unit"]').prop("disabled", false);
				// 	$div.find('input[data-field="conversion"]').prop("disabled", false);
				// 	$div.find('select[id=conversionType]').prop("disabled", false);
				// 	gMain.showMessage("Halllo");
				// } else {
				// 	// $div.find('input[data-field="unit"]').prop("disabled", true);
				// 	$div.find('input[data-field="conversion"]').prop("disabled", true);
				// 	$div.find('select[id=conversionType]').prop("disabled", true);
				// }
			});

			// $div.find('input[data-field="groupFactor"]').prop("disabled", true);
			// //$div.find('input[data-field="test"]').val(values);

			// var isLinked = $div.find('input[data-field="isLinked"]').is(":checked");
			// $div.find('input[data-field="test"]').val(JSON.stringify(values))

			// if ($div.find('input[data-field="isLinked"]').is(":checked"))
			// {
			// 	$div.find('input[data-field="name"]').hide();
			// }

			// $div.find('textarea[id="area"]').val(parentId);
		}
	}

	if (typeof customPostOnSave !== 'undefined') {
		customPostOnSave.linkeddevices = function ($div, instance) {
			gMain.showMessage("Halllo");
			return 'Please enter ID';
			// if (!$div.find('input[data-field="test"]').val() === "") {
			// 	return _('Please enter ID');
			// }
		};
	}
</script>